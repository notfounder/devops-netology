# 4.1. Командная оболочка Bash: Практические навыки

1. Есть скрипт:

   a=1
   b=2
   c=a+b
   d=$a+$b
   e=$(($a+$b))
   Какие значения переменным c, d, e будут присвоены? Почему?

   | Переменная | Значение | Обоснование                                                  |
   | ---------- | -------- | ------------------------------------------------------------ |
   | c          | a+b      | такое значение было определено для переменной "с"            |
   | d          | 1+2      | произошла склейка двух переменных                            |
   | e          | 3        | арифметическая операция при этом не требующая предварительной декларации целых чисел |

1. На нашем локальном сервере упал сервис, и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. После чего скрипт должен завершиться.

   В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на жёстком диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:

   ```bash
   while ((1==1)
   do
   	curl https://localhost:4757
   	if (($? != 0))
   	then
   		date >> curl.log
   	fi
   done
   ```

   **Мой скрипт:**

   ```bash
   #!/usr/bin/env bash
   while ((1==1)) #добавил скобку
   do
   	curl https://localhost:4757
   	if (($? != 0))
   	then
   		date >> curl.log
   	else #если сервис доступен
   	    break #прерываем текущий цикл
   	fi
   done
   ```

1. Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.

   **Мой скрипт:**

   ```bash
   #!/usr/bin/env bash
   ##############################
   #Project: Homework Netology
   #Version 1.0
   #(c) 2023 Notfounder
   ##############################
   
   ip_address=("192.168.0.1" "173.194.222.113" "87.250.250.242")
   port=80
   
   for ip_check in ${ip_address[@]}; do #перебираем массив ip адресов
   
       for ((count = 1; count < 6; count++)); do #перебираем каждое значение из массива 5 раз
           date=$(date "+%d.%m.%Y %H:%M:%S")
           nc -w 1 -z $ip_check $port #проверяем доступность IP адреса по порту
           
           if (($? == 0)); then
               
               result="$date available IP:$ip_check:$port"
   
           else
               
               result="$date NOT AVAILABLE IP:$ip_check:$port"
   
           fi
           
           echo $result >>available.log #записываем результат
       
       done
   
   done
   ```

1. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен — IP этого узла пишется в файл error, скрипт прерывается.

   **Мой скрипт:**

   ```bash
   #!/usr/bin/env bash
   ##############################
   #Project: Homework Netology
   #Version 1.0
   #(c) 2023 Notfounder
   ##############################
   
   ip_address=("192.168.0.1" "173.194.222.113" "87.250.250.242")
   port=80
   
   for ip_check in ${ip_address[@]}; do #перебираем массив ip адресов
   
       for ((count = 1; count < 6; count++)); do #перебираем каждое значение из массива 5 раз
           date=$(date "+%d.%m.%Y %H:%M:%S")
           nc -w 1 -z $ip_check $port 2> /dev/null #проверяем доступность IP адреса по порту
           
           if (($? == 0)); then
               
               result="$date available IP:$ip_check:$port"
   
           else
               
               result="$date NOT AVAILABLE IP:$ip_check:$port"
               echo $result >>available_error.log #записываем в error log результат
               exit 0 #завершаем работу скрипта
           fi
           
           echo $result >>available.log #записываем результат
       
       done
   
   done
   ```
